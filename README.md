# Outer-Capillary-Angle-Analysis 

This script is used to measure the outer capillary angle while it is mounted on
a card and installed in a cartrdige but unconstrained by the CCT mating 
features such as the brass and delrin forks. Because of this, the resultant 
Y angle has negligible meaning. See below for relevance in CCT.  

```
------------------------------------------------------------------------------

        angle x 
          /| 
long.    /
^       /
|      /
|__> lat.

        angle y 
          /| 
long.    /
^       /
|      /
|__> focus
------------------------------------------------------------------------------
```

To use this script either specify the folder which contains your set of test 
data to be analyzed. It is important that each script run takes in data that 
has the same upper and lower bore diameters. 

For instance your file structure may look like: 

```
~/data-folder 
    /inspection-001
        /B03-000003971(0.092-0.052)
            /Bottom Bore
                /img-angle0
                /img-angle90
                /img-angle-180
                /img-angle-270
            /Top Bore
                /img-angle0
                /img-angle90
                /img-angle-180
                /img-angle-270
        /C006-000003958(0.092-0.052)
            /Bottom Bore
                /img-angle0
                /img-angle90
                /img-angle-180
                /img-angle-270
            /Top Bore
                /img-angle0
                /img-angle90
                /img-angle-180
                /img-angle-270
    /inspection-002
        etc
    /inspection-003
        etc
```

To analyze the data contained in inspection-001 (B03 and C006), specify the path during command line UI as: 
"~/data-folder/inspection-001"

Then specify the upper bore diam as: "0.092"  
Then specify the lower bore diam as "0.052" 

*don't include quotation marks* 
------------------------------------------------------------------------------
        
General Overview: 

1. Find rotation axis of upper ledge and capillary position
    - find center (x,y) of each bore in the 4 90 degree rotated angles 
    - take the midpoint of circle origin deviation (in x and y)
    - find the avg capillary position from the 4 images by avg the origin location
    - measure the difference between rotation axis and capillary position (deltaX, deltaY)
2. Find rotation axis of lower ledge and capillary position 
3. Use the known bore size to map pixels to distances 
4. convert (deltaX, deltaY)_upper and (deltaX,deltaY)_lower into inches  
5. Use known ledge separation (0.057") to calculate capillary angle 

------------------------------------------------------------------------------ 

Outputs
In each folder containing a single set cartridge inspection set there should be
a file structure as shown below, asterisks denote outputs that are generated by
the script. Pound symbols are used to add comments but do not effect file 
structure in a meaningful way. 

```
/B03-000003971(0.092-0.052)
    *angle_calc-B03-00003971(0092-0057).txt* # top level outputs (angles)
    /Bottom Bore
        *outputs* # 
            *composite.png* # all circles superimposed on first img
            *composite_outputs.txt* # calculations relevant to these 4 imgs
            *img-angle0-circled* #superimposed predicted circles (red) img 0
            *img-angle90-circled* #superimposed predicted circles (red) img 90
            *img-angle180-circled* #superimposed predicted circles (red) img 180
            *img-angle270-circled* #superimposed predicted circles (red) img 270
        /img-angle0
        /img-angle90
        /img-angle-180
        /img-angle-270
    /Top Bore
        *outputs* # 
            *composite.png* # all circles superimposed on first img
            *composite_outputs.txt* # calculations relevant to these 4 imgs
            *img-angle0-circled* #superimposed predicted circles (red) img 0
            *img-angle90-circled* #superimposed predicted circles (red) img 90
            *img-angle180-circled* #superimposed predicted circles (red) img 180
            *img-angle270-circled* #superimposed predicted circles (red) img 270
        /img-angle0
        /img-angle90
        /img-angle-180
        /img-angle-270
 ```



















